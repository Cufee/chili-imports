(()=>{"use strict";var e=function(){return e=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},e.apply(this,arguments)};var n={domainKey:"CPTenantDomain",routerKey:"CPTenantRouter",maxRetries:5,debug:!0};const t=function(t){return function(n,t){return e(e({},n),t)}(n,t)};function r(e){for(var n=0,t=e.split(" ").filter((function(e){return!["","form-field","pd-hidden","hidden"].includes(e)}));n<t.length;n++){var r=t[n];if(r.includes("CP_"))return r}return""}function o(e){return e&&(n=(t=e)?t.replace(/\s+/g," ").trim():"")?n.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,(function(e){return 0==+e?"":e.toUpperCase()})):"";var n,t}const i=function(e,n){e&&console.debug(n)};function a(e,n){var t,i,a,u="",l="";switch(e.type){case"submit":return{fieldName:"",fieldValue:"",skipped:!0};case"select":u=r(e.className)||(null===(t=e.options)||void 0===t?void 0:t[0].value)||o(null===(i=e.options)||void 0===i?void 0:i[0].textContent)||n[e.name],l=(null===(a=e.options)||void 0===a?void 0:a[e.selectedIndex].value)||"";break;case"radio":e.value=e.checked?"true":"false";default:u=r(e.className)||o(e.placeholder)||n[e.name]||n[e.id]||o(e.name),l=e.value||""}return{fieldName:u,fieldValue:l,skipped:!1}}var u=function(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,u)}l((r=r.apply(e,n||[])).next())}))},l=function(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function c(e,n,r,o,s){return void 0===o&&(o={}),void 0===s&&(s=0),u(this,void 0,void 0,(function(){var u,d,f;return l(this,(function(l){return u=t(o),s>u.maxRetries?(i(u.debug,"Max retries reached, giving up."),[2]):(s++,p=e,(d=document.querySelector(p))?(f=function(e,n,t,r){return!!e&&(n&&t?(e.addEventListener("submit",(function(o){var u=function(e,n){var t;if(!e)return{};for(var r={},o=function(e){var n=e.querySelectorAll("label"),t={};return n.forEach((function(e){e.htmlFor&&(t[e.htmlFor]=e.textContent)})),t}(e),u=0,l=e.elements;u<l.length;u++){var c=l[u];(null===(t=null==c?void 0:c.parentElement)||void 0===t?void 0:t.className.includes("hidden"))&&(c.type="hidden");var s=a(c,o),d=s.fieldName,f=s.fieldValue,p=s.skipped;d||p?r[d]=f:i(n,"No field name found for ".concat(c.name))}return{}}(e,r.debug);u[r.domainKey]=n,u[r.routerKey]=t,window.parent.postMessage({message:"PARDOT_DATA_READY",data:u},"*"),i(r.debug,"PARDOT_DATA_READY fired")})),!0):(console.error("Subdomain and router must be set"),!1))}(d,n,r,u),f||console.error("Failed to add event listener to form ".concat(e)),[2]):(setTimeout((function(){c(e,n,r,o)}),1e3),[2]));var p}))}))}var s=function(){return s=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},s.apply(this,arguments)},d=window.Magical||{},f={PardotFormSetup:function(e,n,t,r){return void 0===r&&(r={}),u(this,void 0,void 0,(function(){return l(this,(function(o){switch(o.label){case 0:return[4,c(e,n,t,r)];case 1:return o.sent(),[2]}}))}))},PardotFormComplete:function(){window.parent.postMessage({message:"PARDOT_FORM_SUCCESS"},"*")},PardotFormRegisterSubmit:function(e,n){void 0===n&&(n={});var r=t(n);e?r.domainKey&&r.routerKey?(window.ChiliPiperLead={},window.addEventListener("message",(function(n){if(n.data&&"PARDOT_DATA_READY"===n.data.message&&n.data.data){var t=n.data.data;new URLSearchParams(window.location.search).forEach((function(e,n){t[n]=e})),window.ChiliPiperLead=t}if(n.data&&"PARDOT_FORM_SUCCESS"===n.data.message){var o=window.ChiliPiperLead;if("function"==typeof r.withCondition&&!r.withCondition(o))return;e(o[r.domainKey],o[r.routerKey],{map:!0,lead:o})}}),!1)):console.error("domainKey and routerKey must be set"):console.error("ChiliPiperFunction must be set")}};window.Magical=s(s({},d),f)})();